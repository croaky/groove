#!/usr/bin/env ruby

require 'rubygems'
require 'thor'

class Groove < Thor::Group
  include Thor::Actions

  argument :name

  def create_gemfile
    create_file("#{name}/.Gemfile") do
<<-RUBY
clear_sources
source "http://gemcutter.org"

gem 'sinatra'

gem 'sinatra-effigy',  :require_as => 'sinatra/effigy'
gem 'sinatra-mongoid', :require_as => 'sinatra/mongoid'
RUBY
    end
  end

  def create_rackup
    create_file("#{name}/config.ru") do
<<-RUBY
require 'app'
require 'rack_hoptoad'

use Rack::HoptoadNotifier, ENV['HOPTOAD'] || '1234'

run Sinatra::Application
RUBY
    end
  end

  def create_app
    create_file("#{name}/app.rb") do
<<-RUBY
require File.dirname(__FILE__) + '/vendor/gems/environment'
Bundler.require_env

set :app_file, __FILE__

set :mongo_db, '#{name}'

configure :production do
  enable :raise_errors
end

get '/' do
  effigy :index
end
RUBY
    end
  end

  def create_template
    create_file("#{name}/templates/index.html") do
<<-HTML
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>#{name}</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js" async></script>
  </head>
  <body>
    <header>
      <h1>#{name}</h1>
    </header>
  </body>
</html>
HTML
    end
  end

  def create_view
    create_file("#{name}/views/index.rb") do
<<-RUBY
class IndexView < Effigy::View
  def transform
  end
end
RUBY
    end
  end

  def create_gitignore
    create_file("#{name}/.gitignore") do
<<-RUBY
vendor/gems/gems
vendor/gems/specifications
vendor/gems/doc
RUBY
    end
  end
end

Groove.start
